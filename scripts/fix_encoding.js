// ä¿®å¤ App.tsx çš„ç¼–ç é—®é¢˜
const fs = require('fs');
const path = require('path');

const filePath = path.join(__dirname, '..', 'src', 'taskpane', 'components', 'App.tsx');

// è¯»å–æ–‡ä»¶
let content = fs.readFileSync(filePath, 'utf8');

// å®šä¹‰æ›¿æ¢æ˜ å°„
const replacements = [
  // æ¬¢è¿æ¶ˆæ¯ - å®Œæ•´æ›¿æ¢æ•´ä¸ªåˆå§‹æ¶ˆæ¯
  ['text: "ä½ å¥½ï¼ğŸ‘‹ æˆ‘å¯ä»¥å¸®ä½ å¤„ç† Excel æ•°æ®ã€‚\\n\\nè¯•è¯•å‘Šè¯‰æˆ‘ï¼š\\nâ€¢ åˆ›å»ºä¸€ä¸ªé”€å”®æ•°æ®è¡¨\\nâ€¢ å¸®æˆ‘åˆ†æè¿™äº›æ•°æ®\\nâ€¢ æ·»åŠ ä¸€ä¸ªå›¾è¡¨"', 
   'text: "ä½ å¥½ï¼ğŸ‘‹ æˆ‘å¯ä»¥å¸®ä½ å¤„ç† Excel æ•°æ®ã€‚\\n\\nè¯•è¯•å‘Šè¯‰æˆ‘ï¼š\\nâ€¢ åˆ›å»ºä¸€ä¸ªé”€å”®æ•°æ®è¡¨\\nâ€¢ å¸®æˆ‘åˆ†æè¿™äº›æ•°æ®\\nâ€¢ æ·»åŠ ä¸€ä¸ªå›¾è¡¨"'],
  
  // ä¿®å¤å„ç§ä¹±ç æ¨¡å¼ - é€šç”¨æ›¿æ¢
  [/text: "[^"]*ä¹±ç æ¨¡å¼[^"]*"/g, 'text: "ä½ å¥½ï¼ğŸ‘‹ æˆ‘å¯ä»¥å¸®ä½ å¤„ç† Excel æ•°æ®ã€‚"'],
];

// æŸ¥æ‰¾å¹¶æ›¿æ¢åŒ…å«ä¹±ç çš„æ¬¢è¿æ¶ˆæ¯
// åŒ¹é… messages çš„åˆå§‹åŒ–éƒ¨åˆ†
const messagesRegex = /const \[messages, setMessages\] = React\.useState<ChatMessage\[\]>\(\[\s*\{\s*id: uid\(\),\s*role: "assistant",\s*text: "[^"]*",\s*timestamp: new Date\(\),\s*\},\s*\]\);/;

const newMessagesInit = `const [messages, setMessages] = React.useState<ChatMessage[]>([
    {
      id: uid(),
      role: "assistant",
      text: "ä½ å¥½ï¼ğŸ‘‹ æˆ‘å¯ä»¥å¸®ä½ å¤„ç† Excel æ•°æ®ã€‚\\n\\nè¯•è¯•å‘Šè¯‰æˆ‘ï¼š\\nâ€¢ åˆ›å»ºä¸€ä¸ªé”€å”®æ•°æ®è¡¨\\nâ€¢ å¸®æˆ‘åˆ†æè¿™äº›æ•°æ®\\nâ€¢ æ·»åŠ ä¸€ä¸ªå›¾è¡¨",
      timestamp: new Date(),
    },
  ]);`;

if (messagesRegex.test(content)) {
  content = content.replace(messagesRegex, newMessagesInit);
  console.log('Fixed: messages initialization');
}

// ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢
const simpleReplacements = {
  'æ­£åœ¨æ‰§è¡Œ...': 'æ­£åœ¨æ‰§è¡Œ...',
  'æ€è€ƒä¸­...': 'æ€è€ƒä¸­...',
  'å†™å…¥ ': 'å†™å…¥ ',
  'åº”ç”¨å…¬å¼': 'åº”ç”¨å…¬å¼',
  'å†™å…¥å•å…ƒæ ¼': 'å†™å…¥å•å…ƒæ ¼',
  'åº”ç”¨': 'åº”ç”¨',
  'ç¡®è®¤æ“ä½œ': 'ç¡®è®¤æ“ä½œ',
  'å³å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š': 'å³å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š',
  'ç¡®è®¤': 'ç¡®è®¤',
  'å–æ¶ˆ': 'å–æ¶ˆ',
  'æ¸…é™¤': 'æ¸…é™¤',
  'ä¿å­˜': 'ä¿å­˜',
  'é…ç½® API': 'é…ç½® API',
  'DeepSeek API å¯†é’¥': 'DeepSeek API å¯†é’¥',
  'åç«¯ ': 'åç«¯ ',
  'å·²è¿æ¥': 'å·²è¿æ¥',
  'æœªè¿æ¥': 'æœªè¿æ¥',
  'å½“å‰: ': 'å½“å‰: ',
  'Excel æ™ºèƒ½åŠ©æ‰‹': 'Excel æ™ºèƒ½åŠ©æ‰‹',
  'é€‰ä¸­æ•°æ®åŒºåŸŸï¼Œå‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆ': 'é€‰ä¸­æ•°æ®åŒºåŸŸï¼Œå‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆ',
  'æ€»ç»“å½“å‰é€‰ä¸­çš„æ•°æ®': 'æ€»ç»“å½“å‰é€‰ä¸­çš„æ•°æ®',
  'æ€»ç»“æ•°æ®': 'æ€»ç»“æ•°æ®',
  'ä¸ºå½“å‰æ•°æ®ç”Ÿæˆå…¬å¼': 'ä¸ºå½“å‰æ•°æ®ç”Ÿæˆå…¬å¼',
  'ç”Ÿæˆå…¬å¼': 'ç”Ÿæˆå…¬å¼',
  'ä¸ºæ•°æ®åˆ›å»ºåˆé€‚çš„å›¾è¡¨': 'ä¸ºæ•°æ®åˆ›å»ºåˆé€‚çš„å›¾è¡¨',
  'åˆ›å»ºå›¾è¡¨': 'åˆ›å»ºå›¾è¡¨',
  'åˆ†ææ•°æ®è¶‹åŠ¿å’Œå¼‚å¸¸': 'åˆ†ææ•°æ®è¶‹åŠ¿å’Œå¼‚å¸¸',
  'åˆ†æè¶‹åŠ¿': 'åˆ†æè¶‹åŠ¿',
  'æè¿°ä½ æƒ³å¯¹æ•°æ®åšçš„æ“ä½œ...': 'æè¿°ä½ æƒ³å¯¹æ•°æ®åšçš„æ“ä½œ...',
  'åç«¯æœåŠ¡æœªè¿æ¥': 'åç«¯æœåŠ¡æœªè¿æ¥',
  'è®©æˆ‘æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡...': 'è®©æˆ‘æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡...',
  'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚è¯·åˆ·æ–°é¡µé¢åé‡è¯•ã€‚': 'æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚è¯·åˆ·æ–°é¡µé¢åé‡è¯•ã€‚',
  'æ“ä½œæŒ‰é’®': 'æ“ä½œæŒ‰é’®',
};

// æ£€æŸ¥è¿™äº›å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚æœå·²ç»æ­£ç¡®å°±ä¸éœ€è¦æ›¿æ¢ï¼‰
let fixedCount = 0;
for (const [correct, replacement] of Object.entries(simpleReplacements)) {
  if (content.includes(correct)) {
    // å·²ç»æ­£ç¡®ï¼Œè·³è¿‡
  }
}

// å†™å›æ–‡ä»¶
fs.writeFileSync(filePath, content, 'utf8');
console.log('File saved with UTF-8 encoding');

// æ˜¾ç¤ºæ–‡ä»¶å‰å‡ è¡Œä»¥éªŒè¯
const lines = content.split('\n').slice(2555, 2575);
console.log('\nLines 2556-2575:');
lines.forEach((line, i) => console.log(`${2556 + i}: ${line.substring(0, 80)}`));
